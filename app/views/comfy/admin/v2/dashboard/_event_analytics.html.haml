= turbo_frame_tag event_category do
  - if event_category === Ahoy::Event::EVENT_CATEGORIES[:page_visit]
    %section.row.vr-analytics-section.vr-analytics-page-visit-events
      .col{ class: events_exists ? "col-lg-9 mb-4" : "col-12" }
        .d-flex.justify-content-between
          .vr-analytics-section-header.d-md-flex.justify-content-between.align-items-center
            .vr-analytics-sub-title
              = "#{page_name(params[:page])} visits"
            - if events_exists
              .d-flex.justify-content-between.align-items-center.mt-2.mt-md-0
                .vr-analytics-count
                  = events_count
                  total visits
                .vr-analytics-percent-change
                  = display_percent_change(events_count, previous_period_events_count)
                .vr-analytics-tooltips{ data: { toggle: "tooltip", placement: "right" }, title: tooltip_content(events_count, previous_period_events_count, params[:interval], @start_date, @end_date) }
                  ?
        .vr-analytics-section-body
          - if events_exists
            = column_chart page_visit_chart_data(current_period_events, @start_date, @end_date), colors: ["#88DAE3FF", "#D785E3FF", "#F7C85CFF"], library: { plugins: { legend: { position: "top", align: "end", labels: { padding: 24, boxWidth: 8, usePointStyle: true, font: { size: 16 } } } }  }
          - else
            .vr-analytics-blank-states
              There are no page visit events within the selected date range. 
              %br
              Use 'data-violet-track-page-visit="true"' attribute on a html attribute to track page visits.
              %br
              %br
              %code
                :escaped
                  <main data-violet-track-page-visit="true" data-violet-event-name="landing-page-viewed" data-violet-event-label="Landing Page">
                %br
                :escaped
                  .
                %br
                :escaped
                  .
                %br
                :escaped
                  </main>
      - if events_exists
        .col.col-lg-3
          .vr-analytics-card.vr-analytics-page-visit-events-donut-chart
            %h5 Website visitors
            = pie_chart visitors_chart_data(current_period_events), colors: ['#F7A47B', '#B5E69A'], donut: true, library: { cutout: 85, plugins: { legend: { position: "bottom",  align: 'start', labels: {boxWidth: 8, usePointStyle: true, font: { size: 16 } } } } }
  - elsif event_category === Ahoy::Event::EVENT_CATEGORIES[:video_view]
    %section.vr-analytics-section
      .vr-analytics-section-header
        .row.align-items-center
          .vr-analytics-sub-title.col.col-12.col-md-2
            Watch time

          - if events_exists 
            .col.col-md-10
              .row
                - watch_time = total_watch_time(current_period_events)
                - previous_watch_time = total_watch_time(previous_period_events)
                .col.col-12.col-sm-4.d-flex.align-items-center.my-3.my-sm-0
                  .vr-analytics-count.ml-0
                    Total watch time
                    = to_minutes(watch_time)
                  .vr-analytics-percent-change
                    = display_percent_change(watch_time, previous_watch_time)
                  .vr-analytics-tooltips{ data: { toggle: "tooltip", placement: "right" }, title: tooltip_content(watch_time, previous_watch_time, params[:interval], @start_date, @end_date) }
                    ?
            
                .col.col-12.col-sm-4.d-flex.align-items-center.mb-3.mb-sm-0
                  .vr-analytics-count.ml-0
                    Avg. view duration
                    - view_duration = avg_view_duration(current_period_events)
                    - previous_view_duration = avg_view_duration(previous_period_events)
                    = to_minutes(view_duration)
                  .vr-analytics-percent-change
                    = display_percent_change(view_duration, previous_view_duration)
                  .vr-analytics-tooltips{ data: { toggle: "tooltip", placement: "right" }, title: tooltip_content(view_duration, previous_view_duration, params[:interval], @start_date, @end_date) }
                    ?

                .col.col-12.col-sm-4.d-flex.align-items-center.mb-3.mb-sm-0
                  .vr-analytics-count.ml-0
                    Avg. view percentage
                    - view_percent = avg_view_percentage(current_period_events)
                    - previous_view_percent = avg_view_percentage(previous_period_events)
                    = "#{view_percent.round(2)}%"
                  .vr-analytics-percent-change
                    = display_percent_change(view_percent, previous_view_percent)
                  .vr-analytics-tooltips{ data: { toggle: "tooltip", placement: "right" }, title: tooltip_content(view_percent, previous_view_percent, params[:interval], @start_date, @end_date) }
                    ?
      - if events_exists 
        .vr-analytics-section-body
          .vr-analytics-event-label 
            - top_videos = top_three_videos(current_period_events, previous_period_events)
            = "Top #{top_videos.size} videos"

          .row.mt-4
            - top_videos.each do |event|
              .col.col-12.col-lg-5.mb-4
                .vr-analytics-card
                  = link_to '', dashboard_events_path(ahoy_event_type: event[:name])
                  .vr-analytics-card-section
                    .d-flex 
                      .vr-analytics-card-resource-poster-conatiner
                        %img{src: event[:resource_image]}
                      .vr-analytics-card-resource-title-duration
                        .vr-analytics-card-resource-title
                          = link_to event[:resource_title], api_namespace_resource_path(api_namespace_id: event[:namespace_id], id: event[:resource_id])
                        .vr-analytics-card-resource-duration
                          = Time.at(event[:duration]/1000).strftime("%M:%S")

                  %hr
                  .vr-analytics-card-section
                    .row
                      .col.col-6
                        .d-flex.align-items-center
                          .vr-analytics-count-lg
                            = to_minutes(event[:total_watch_time])
                          .vr-analytics-percent-change
                            = display_percent_change(event[:total_watch_time], event[:previous_period_total_watch_time])
                        .vr-analytics-event-label.mt-2
                          Total watch time
                      .col.col-6 
                        .d-flex.align-items-center
                          .vr-analytics-count-lg
                            = event[:total_views]
                          .vr-analytics-percent-change
                            = display_percent_change(event[:total_views], event[:previous_period_total_views])
                        .vr-analytics-event-label.mt-2
                          Total views
      - else
        .vr-analytics-blank-states
          There are no video view events within the selected date range. 
          %br
          Use 'data-violet-track-video-view="true"' attribute on a video element to track views.
          %br
          %br
          %code
            :escaped
              <video data-violet-track-video-view="true" data-violet-resource-id="<%= resource.id %>" data-violet-event-name="intro_video_watch" data-violet-event-label="Intro Video" width="500px"  controls>
            %br
            :escaped
              <source src="<%= resource.props['demo'].file_url %>" type="video/mp4">
            %br
            :escaped
              </video>

          %br
          %br

          Please make sure 'data-violet-resource-id' is present and Analytics mapping is populated
  - else
    %section.vr-analytics-section.vr-analytics-events
      .vr-analytics-section-header
        .d-md-flex.align-items-center
          .vr-analytics-sub-title
            = event_title(event_category)
          - if events_exists
            .d-flex.align-items-center.mt-2.mt-md-0
              .vr-analytics-count
                = events_count 
                = "total #{event_types(event_category)}"
              .vr-analytics-percent-change
                = display_percent_change(events_count, previous_period_events_count)
              .vr-analytics-tooltips{ data: { toggle: "tooltip", placement: "right" }, title: tooltip_content(events_count, previous_period_events_count, params[:interval], @start_date, @end_date) }
                ?

      - if events_exists
        .vr-analytics-section-body.d-flex.align-items-center
          .vr-analytics-events-grid.row.w-100
            - label_grouped_event.each do |key, value|
              .vr-analytics-events-grid-item.col.col-12.col-sm-6.col-md-4.col-lg-3.mb-4
                .d-flex.mr-4.align-items-center.mb-2
                  .vr-analytics-count-lg
                    = value.size 
                  .vr-analytics-percent-change
                    = display_percent_change(value.size, previous_grouped_events[key].to_i)
                  - if previous_grouped_events[key].to_i == 0
                    .vr-analytics-tooltips{ data: { toggle: "tooltip", placement: "right" }, title: tooltip_content(value.size, 0, params[:interval], @start_date, @end_date) }
                      ?
                = link_to key, dashboard_events_path(ahoy_event_type: value.first), class: 'vr-analytics-event-label'

  - unless events_exists
    - if event_category === Ahoy::Event::EVENT_CATEGORIES[:click]
      .vr-analytics-blank-states
        There are no click events within the selected date range. 
        %br
        Use 'data-violet-track-click="true"' attribute on a html element to track clicks.
        %br
        %br
        %code
          :escaped
            <a data-violet-track-click="true" data-violet-event-name="test-link-clicked" data-violet-event-label="Test Link">Test</a>

    - if event_category === Ahoy::Event::EVENT_CATEGORIES[:section_view]
      .vr-analytics-blank-states
        There are no section view events within the selected date range. 
        %br
        Use 'data-violet-track-section-view="true"' attribute on a HTML element to track section views.
        %br
        %br
        %code
          :escaped
            <div data-violet-track-section-view="true" data-violet-event-name="test-section-viewed" data-violet-event-label="Test Section">
          %br
          :escaped
            .
          %br 
          :escaped
            .
          %br
          :escaped
            </div>

        %br
        %br
        Make sure to adjust target visibility threshold for large sections with 'data-violet-visibility-threshold'.
        %br
        Threshold indicates at what percentage of the target's visibility the tracking should be executed
        %br
        %a{href: 'https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API#thresholds'}
          https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API#thresholds

        %br
        %br
        By default, the threshold value is 0.75

    - if event_category === Ahoy::Event::EVENT_CATEGORIES[:form_submit]
      .vr-analytics-blank-states
        There are no form submission events within the selected date range. 
        %br
        Use 'data-violet-track-from-submit="true"' attribute on a form element to track form submissions.
        %br
        %br
        %code
          :escaped
            {{ cms:helper render_form, 1, { data: { violet-track-form-submit: true }}}}
        %br
        %br
        Default event name withh me <code>\#{api_namespace.slug}-form-submit</code> and default event label will be <code>\#{api_namespace.slug} Form Submit</code>, which can be overridden with 'data-violet-event-name' and 'data-violet-event-label' respectively.
        %br
        %br
        OR 
        %br
        %br
        %code
          :escaped
            <form data-violet-track-form-submit="true" data-violet-event-name="inquiry-form-submited" data-violet-event-label="Inquiry Form">
          %br
          :escaped
            .
          %br 
          :escaped
            .
          %br
          :escaped
            </form>